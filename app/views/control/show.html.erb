<% if @device.control_template.blank? || @device.control_template == 'default' %>
  <a href="/control/<%= @device.id %>/edit" class="pull-right" id="control-settings" style="font-size: 20px; width: 25px; height: 25px; padding: 0;">
    <span class="glyphicon glyphicon-cog" style="padding: 0 0 0 3px;"></span>
  </a>

  <h1><%= @device.name %> controls</h1>
  <br>
  <%= render 'devices/controls' %>
<% elsif @device.control_template == 'drive' %>

  <table style="border-spacing: 5px; border-collapse: separate;">
    <tr>
      <td></td>
      <td>
        <span id="drive-forward" class="glyphicon glyphicon-arrow-up control-button"></span>
      </td>
    </tr>
    <tr>
      <td><span id="drive-left" class="glyphicon glyphicon-arrow-left control-button"></span></td>
      <td></td>
      <td><span id="drive-right" class="glyphicon glyphicon-arrow-right control-button"></span></td>
    </tr>
    <tr>
      <td></td>
      <td><span id="drive-reverse" class="glyphicon glyphicon-arrow-down control-button"></span></td>
      <td></td>
    </tr>
  </table>

<% end %>

<script>

  // keep track of the start transmission time
  var start_transmission_time = 0;

  // when the document is ready
  $(document).ready(function() {

    // when the drive-forward button is clicked
    $('#drive-forward').on('mousedown', function() {
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 21, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 19, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 20, digital: 'on' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 26, digital: 'on' };
      // send the message
      App.messaging.send_message(message);
    });

    // when the drive-reverse button is clicked
    $('#drive-reverse').on('mousedown', function() {
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 20, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 26, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 21, digital: 'on' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 19, digital: 'on' };
      // send the message
      App.messaging.send_message(message);
    });

    // when the drive-left button is clicked
    $('#drive-left').on('mousedown', function() {
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 19, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 26, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 21, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 20, digital: 'on' };
      // send the message
      App.messaging.send_message(message);
    });

    // when the drive-right button is clicked
    $('#drive-right').on('mousedown', function() {
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 19, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 20, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 21, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 26, digital: 'on' };
      // send the message
      App.messaging.send_message(message);
    });

    // when the mouse is released
    $('#drive-right, #drive-left, #drive-forward, #drive-reverse').on('mouseup', function() {
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 19, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 20, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 21, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
      // create the message
      var message = { i2c_address: '<%= @device.i2c_address %>', pin: 26, digital: 'off' };
      // send the message
      App.messaging.send_message(message);
    });

    // create the subscription
    App.messaging = App.cable.subscriptions.create(
      {
        channel: 'DevicesChannel',
        id: <%= @master_device.id %>,
        auth_token: '<%= @master_device.auth_token %>'
      },
      {

        // when data is received
        received: function(data) {

        },

        // function to send a message
        send_message: function(message) {
          // mark the start time
          start_transmission_time = (new Date).getTime();

          // perform the "receive" action in app/channels/devices_channel.rb
          this.perform('receive', message);
        }

      }
    );

  });

</script>
